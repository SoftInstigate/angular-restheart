!function(){"use strict";angular.module("restheart",["LocalStorageModule","base64","restangular"]).provider("restheart",function(){this.setBaseUrl=function(e){this.baseUrl=e},this.setLogicBaseUrl=function(e){this.logicBaseUrl=e},this.onForbidden=function(e){this.onForbidden=e},this.onTokenExpired=function(e){this.onTokenExpired=e},this.onUnauthenticated=function(e){this.onUnauthenticated=e},this.$get=function(){return this}})}(),function(){"use strict";function e(e,t){e.setStorageType("sessionStorage"),t.setRestangularFields({id:"_id",etag:"_etag",selfLink:"_links['self'].href"}),t.addResponseInterceptor(function(e,t,n,r,i,a){var s;return"getList"===t?(angular.isUndefined(e)||angular.isUndefined(e._embedded)?s=[]:(s=angular.isDefined(e._embedded["rh:doc"])?e._embedded["rh:doc"]:angular.isDefined(e._embedded["rh:file"])?e._embedded["rh:file"]:angular.isDefined(e._embedded["rh:bucket"])?e._embedded["rh:bucket"]:angular.isDefined(e._embedded["rh:coll"])?e._embedded["rh:coll"]:angular.isDefined(e._embedded["rh:db"])?e._embedded["rh:db"]:[],angular.isDefined(e._embedded["rh:warnings"])&&(s._warnings=e._embedded["rh:warnings"])),s._returned=e._returned,s._size=e._size,s._total_pages=e._total_pages,s._links=e._links):s=e,s}),t.setDefaultHeaders({Accept:"application/hal+json","Content-Type":"application/json","No-Auth-Challenge":"true"})}angular.module("restheart").config(e),e.$inject=["localStorageServiceProvider","RestangularProvider"]}(),function(){"use strict";function e(e){return e.withConfig(function(e){e.setFullResponse(!0)})}angular.module("restheart").factory("FRh",e),e.$inject=["Rh"]}(),function(){"use strict";function e(e,t,n,r,i){return e.withConfig(function(e){function a(){var e=t.get("authtoken");angular.isDefined(e)&&null!==e&&(i.defaults.headers.common.Authorization="Basic "+t.get("authtoken"))}function s(e){var i=t.get("authtoken");return 401===e.status&&angular.isDefined(i)&&null!==i?(t.set("Error 401",{why:"expired",from:n.path(),params:routeParams}),r.onTokenExpired(),!0):!1}function o(e){if(403===e.status){var i=t.get("authtoken");return angular.isDefined(i)&&null!==i?(t.set("Error 403",{why:"forbidden",from:n.path()}),r.onForbidden()):r.onUnauthenticated(),!0}return!1}var u=r.baseUrl;if(angular.isDefined(u)&&null!==u)e.setBaseUrl(u);else{var d;d="http://"+n.host()+":8080",t.set("restheartUrl",d),e.setBaseUrl(d)}e.setErrorInterceptor(function(e,t,n){var r=s(e),i=o(e);return!(r||i)}),e.setRequestInterceptor(function(e,t){return a(),e})})}angular.module("restheart").factory("Rh",e),e.$inject=["Restangular","localStorageService","$location","restheart","$http"]}(),function(){"use strict";function e(e,t,n,r,i,a){this.setAuthHeader=function(n,r){t.defaults.headers.common.Authorization="Basic "+e.encode(n+":"+r)},this.saveAuthInfo=function(t,r,i){var a=e.encode(t+":"+r);return n.set("userid",t),n.set("authtoken",a),n.set("nav",e.encode(JSON.stringify(i))),a},this.clearAuthInfo=function(){var e=n.get("restheartUrl"),r=n.get("redirected");n.clearAll(),n.set("restheartUrl",e),n.set("redirected",r),angular.isUndefined(t)||angular.isUndefined(t.defaults)||delete t.defaults.headers.common.Authorization},this.getAuthHeader=function(){return n.get("authtoken")},this.getUserid=function(){return n.get("userid")},this.getUserRoles=function(){var t=n.get("nav");return JSON.parse(e.decode(t))},this.isAuthenticated=function(){var e=this.getAuthHeader(n);return!(angular.isUndefined(e)||null===e)},this.signin=function(e,t){var n=this;return i(function(i,a){n.clearAuthInfo(),n.setAuthHeader(e,t);var s={nocache:(new Date).getTime()};r.one("roles",e).get(s).then(function(t){var r=t.headers("Auth-Token");return null===r?(n.clearAuthInfo(),void i(!1)):(n.saveAuthInfo(e,r,t.data.roles),n.setAuthHeader(e,r),void i(!0))},function(e){i(!1)})})},this.signout=function(e){var t=this;return i(function(r,i){if(e){var s=n.get("userid");a.one("_authtokens",s).remove().then(function(){t.clearAuthInfo(),r(!0)},function(e){r(!1)})}else this.clearAuthInfo(),r(!0)})}}angular.module("restheart").service("RhAuth",e),e.$inject=["$base64","$http","localStorageService","RhLogic","$q","Rh"]}(),function(){"use strict";function e(e,t,n,r){return e.withConfig(function(e){function i(e){return 401===e.status?(t.set("Error 401",{why:"wrong credentials",from:n.path()}),r.onUnauthenticated(),!0):!1}e.setFullResponse(!0);var a=r.logicBaseUrl;if(angular.isDefined(a)&&null!==a)e.setBaseUrl(a);else{var s;s="http://"+n.host()+":8080/_logic",e.setBaseUrl(s)}e.setErrorInterceptor(function(e,t,n){var r=i(e);return r})})}angular.module("restheart").factory("RhLogic",e),e.$inject=["Restangular","localStorageService","$location","restheart"]}();