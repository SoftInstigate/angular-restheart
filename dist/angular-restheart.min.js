!function(){"use strict";function e(){this.setBaseUrl=function(e){this._baseUrl=e},this.setLogicBaseUrl=function(e){this._logicBaseUrl=e},this.getBaseUrl=function(){return this._baseUrl},this.getLogicBaseUrl=function(){return this._logicBaseUrl},this.onForbidden=function(e){this.onForbidden=e},this.onTokenExpired=function(e){this.onTokenExpired=e},this.onUnauthenticated=function(e){this.onUnauthenticated=e},this.onNetworkError=function(e){this.onNetworkError=e},this.$get=function(){return this}}angular.module("restheart",["LocalStorageModule","base64","restangular","ui.router"]).provider("restheart",e)}(),function(){"use strict";function e(e,t){e.setPrefix("rh"),e.setStorageType("sessionStorage"),t.setRestangularFields({id:"_id.$oid",etag:"_etag.$oid",selfLink:"_links['self'].href"}),t.addResponseInterceptor(function(e,t,r,n,a,i){var o=[];if("getList"===t){angular.isDefined(e._embedded)&&(angular.isArray(e._embedded)?o=e._embedded:angular.forEach(e._embedded,function(e,t){0===t.lastIndexOf("rh:",0)&&"rh:warnings"!==t&&(o=_.union(o,e))}),angular.isDefined(e._embedded["rh:warnings"])&&(o._warnings=e._embedded["rh:warnings"]),angular.isDefined(e._warnings)&&(o._warnings=_warnings));for(var s in e)o[s]=e[s]}else o=e;return o}),t.setDefaultHeaders({Accept:"application/hal+json","Content-Type":"application/json","No-Auth-Challenge":"true"})}angular.module("restheart").config(["localStorageServiceProvider","RestangularProvider",e])}(),function(){"use strict";function e(e){return e.withConfig(function(e){e.setFullResponse(!0)})}angular.module("restheart").factory("FRh",["Rh",e])}(),function(){"use strict";function e(e,t,r,n,a,i,o){this.clearAuthInfo=function(){t.remove("rh_userid"),t.remove("rh_authtoken"),t.remove("rh_nav"),angular.isUndefined(o)||angular.isUndefined(o.defaults)||delete o.defaults.headers.common.Authorization};var s=this;return e.withConfig(function(e){function u(){var e=t.get("rh_authtoken");angular.isDefined(e)&&null!==e&&(o.defaults.headers.common.Authorization="Basic "+t.get("rh_authtoken"))}function h(e){var o=t.get("rh_authtoken");401===e.status&&angular.isDefined(o)&&null!==o&&(s.clearAuthInfo(),t.set("rh_autherror",{why:"expired",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onTokenExpired)&&i.onTokenExpired(r,n))}function c(e){if(403===e.status){var o=t.get("rh_authtoken");angular.isDefined(o)&&null!==o?(t.set("rh_autherror",{why:"forbidden",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onForbidden)&&i.onForbidden(r,n)):angular.isFunction(i.onUnauthenticated)&&(s.clearAuthInfo(),t.set("rh_autherror",{why:"not_authenticated",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onUnauthenticated)&&i.onUnauthenticated(r,n))}}function l(e){e.status===-1&&(t.set("rh_networkError",{why:"network_error",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onNetworkError)&&i.onNetworkError(r,n))}var d=i.getBaseUrl();if(angular.isDefined(d)&&null!==d)t.set("rh_baseUrl",d),e.setBaseUrl(d);else{if(!angular.isDefined(t.get("rh_baseUrl")))throw"Rh ERROR: baseUrl not found with localStorageService.get('rh_baseUrl')";d=t.get("rh_baseUrl"),e.setBaseUrl(d)}e.setErrorInterceptor(function(e,t,r){h(e),c(e),l(e)}),e.setRequestInterceptor(function(e,t){return u(),e})})}angular.module("restheart").factory("Rh",["Restangular","localStorageService","$location","$state","$stateParams","restheart","$http",e])}(),function(){"use strict";function e(e,t,r,n,a,i,o){this.getBaseUrl=function(){return o.getBaseUrl()},this.getLogicBaseUrl=function(){return o.getLogicBaseUrl()},this.setAuthHeader=function(r,n){t.defaults.headers.common.Authorization="Basic "+e.encode(r+":"+n)},this.saveAuthInfo=function(t,n,a){var i=e.encode(t+":"+n);return r.set("rh_userid",t),r.set("rh_authtoken",i),r.set("rh_nav",e.encode(JSON.stringify(a))),i},this.clearAuthInfo=function(){r.remove("rh_userid"),r.remove("rh_authtoken"),r.remove("rh_nav"),angular.isUndefined(t)||angular.isUndefined(t.defaults)||delete t.defaults.headers.common.Authorization},this.getAuthHeader=function(){return r.get("rh_authtoken")},this.getUserid=function(){return r.get("rh_userid")},this.getUserRoles=function(){var t=r.get("rh_nav");return angular.isString(t)?JSON.parse(e.decode(t)):void 0},this.isAuthenticated=function(){var e=this.getAuthHeader(r);return!(angular.isUndefined(e)||null===e)},this.signin=function(e,t){var r=this;return a(function(a,i){r.clearAuthInfo(),r.setAuthHeader(e,t);var o={nocache:(new Date).getTime()};n.one("roles",e).get(o).then(function(t){var n=t.headers("Auth-Token");return null===n?(r.clearAuthInfo(),void a(!1)):(r.saveAuthInfo(e,n,t.data.roles),r.setAuthHeader(e,n),void a(!0))},function(e){401===e.status?a(!1):i(e)})})},this.signout=function(e){var t=this;return a(function(n,a){if(e){var o=r.get("rh_userid");i.one("_authtokens",o).remove().then(function(){t.clearAuthInfo(),n(!0)},function(e){a(e)})}else t.clearAuthInfo(),n(!0)})}}angular.module("restheart").service("RhAuth",["$base64","$http","localStorageService","RhLogic","$q","Rh","restheart",e])}(),function(){"use strict";function e(e,t,r,n,a,i){return e.withConfig(function(e){function o(e){401===e.status&&(t.set("rh_autherror",{why:"not_authenticated",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onUnauthenticated)&&i.onUnauthenticated(r,n))}function s(e){e.status===-1&&(t.set("rh_networkError",{why:"network_error",path:r.path(),state:n.current.name,params:a}),angular.isFunction(i.onNetworkError)&&i.onNetworkError(r,n))}e.setFullResponse(!0);var u=i.getLogicBaseUrl();if(angular.isDefined(u)&&null!==u)t.set("rh_logicBaseUrl",u),e.setBaseUrl(u);else{if(!angular.isDefined(t.get("rh_logicBaseUrl")))throw"RhLogic ERROR: logicBaseUrl not found with localStorageService.get('rh_logicBaseUrl')";u=t.get("rh_logicBaseUrl"),e.setBaseUrl(u)}e.setErrorInterceptor(function(e,t,r){o(e),s(e)})})}angular.module("restheart").factory("RhLogic",["Restangular","localStorageService","$location","$state","$stateParams","restheart",e])}();