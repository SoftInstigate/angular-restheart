!function(){"use strict";angular.module("restheart",["LocalStorageModule","base64","restangular","ui.router"]).provider("restheart",function(){this.setBaseUrl=function(e){this.baseUrl=e},this.setLogicBaseUrl=function(e){this.logicBaseUrl=e},this.onForbidden=function(e){this.onForbidden=e},this.onTokenExpired=function(e){this.onTokenExpired=e},this.onUnauthenticated=function(e){this.onUnauthenticated=e},this.$get=function(){return this}})}(),function(){"use strict";function e(e,t){e.setPrefix("rh"),e.setStorageType("sessionStorage"),t.setRestangularFields({id:"_id",etag:"_etag",selfLink:"_links['self'].href"}),t.addResponseInterceptor(function(e,t,n,r,a,i){var o=[];return"getList"===t?angular.isDefined(e._embedded)&&(angular.forEach(e._embedded,function(e,t){0===t.lastIndexOf("rh:",0)&&"rh:warnings"!==t&&(o=_.union(o,e))}),angular.isDefined(e._embedded)&&angular.isDefined(e._embedded["rh:warnings"])&&(o._warnings=e._embedded["rh:warnings"]),o._returned=e._returned,o._size=e._size,o._total_pages=e._total_pages,o._links=e._links):o=e,o}),t.setDefaultHeaders({Accept:"application/hal+json","Content-Type":"application/json","No-Auth-Challenge":"true"})}angular.module("restheart").config(e),e.$inject=["localStorageServiceProvider","RestangularProvider"]}(),function(){"use strict";function e(e){return e.withConfig(function(e){e.setFullResponse(!0)})}angular.module("restheart").factory("FRh",e),e.$inject=["Rh"]}(),function(){"use strict";function e(e,t,n,r,a,i){this.clearAuthInfo=function(){t.remove("rh_userid"),t.remove("rh_authtoken"),t.remove("rh_nav"),angular.isUndefined(i)||angular.isUndefined(i.defaults)||delete i.defaults.headers.common.Authorization};var o=this;return e.withConfig(function(e){function s(){var e=t.get("rh_authtoken");angular.isDefined(e)&&null!==e&&(i.defaults.headers.common.Authorization="Basic "+t.get("rh_authtoken"))}function u(e){var i=t.get("rh_authtoken");return 401===e.status&&angular.isDefined(i)&&null!==i?(o.clearAuthInfo(),t.set("rh_autherror",{why:"expired",from:n.path()}),angular.isFunction(a.onTokenExpired)&&a.onTokenExpired(n,r),!0):!1}function h(e){if(403===e.status){var i=t.get("rh_authtoken");return angular.isDefined(i)&&null!==i?(t.set("rh_autherror",{why:"forbidden",from:n.path()}),angular.isFunction(a.onForbidden)&&a.onForbidden(n,r)):angular.isFunction(a.onUnauthenticated)&&(o.clearAuthInfo(),t.set("rh_autherror",{why:"not_authenticated",from:n.path()}),a.onUnauthenticated(n,r)),!0}return!1}var c=a.baseUrl;if(angular.isDefined(c)&&null!==c)e.setBaseUrl(c);else{var l;l="http://"+n.host()+":8080",e.setBaseUrl(l)}e.setErrorInterceptor(function(e,t,n){var r=u(e),a=h(e);return!(r||a)}),e.setRequestInterceptor(function(e,t){return s(),e})})}angular.module("restheart").factory("Rh",e),e.$inject=["Restangular","localStorageService","$location","$state","restheart","$http"]}(),function(){"use strict";function e(e,t,n,r,a,i){this.setBaseUrl=function(e){i.setBaseUrl(e)},this.setLogicBaseUrl=function(e){r.setBaseUrl(e)},this.setAuthHeader=function(n,r){t.defaults.headers.common.Authorization="Basic "+e.encode(n+":"+r)},this.saveAuthInfo=function(t,r,a){var i=e.encode(t+":"+r);return n.set("rh_userid",t),n.set("rh_authtoken",i),n.set("rh_nav",e.encode(JSON.stringify(a))),i},this.clearAuthInfo=function(){n.remove("rh_userid"),n.remove("rh_authtoken"),n.remove("rh_nav"),angular.isUndefined(t)||angular.isUndefined(t.defaults)||delete t.defaults.headers.common.Authorization},this.getAuthHeader=function(){return n.get("rh_authtoken")},this.getUserid=function(){return n.get("rh_userid")},this.getUserRoles=function(){var t=n.get("rh_nav");return JSON.parse(e.decode(t))},this.isAuthenticated=function(){var e=this.getAuthHeader(n);return!(angular.isUndefined(e)||null===e)},this.signin=function(e,t,n){var i=this;return a(function(n,a){i.clearAuthInfo(),i.setAuthHeader(e,t);var o={nocache:(new Date).getTime()};r.one("roles",e).get(o).then(function(t){var r=t.headers("Auth-Token");return null===r?(i.clearAuthInfo(),void n(!1)):(i.saveAuthInfo(e,r,t.data.roles),i.setAuthHeader(e,r),void n(!0))},function(e){401===e.status?n(!1):a(e)})})},this.signout=function(e){var t=this;return a(function(r,a){if(e){var o=n.get("rh_userid");i.one("_authtokens",o).remove().then(function(){t.clearAuthInfo(),r(!0)},function(e){a(e)})}else t.clearAuthInfo(),r(!0)})}}angular.module("restheart").service("RhAuth",e),e.$inject=["$base64","$http","localStorageService","RhLogic","$q","Rh"]}(),function(){"use strict";function e(e,t,n,r){return e.withConfig(function(e){function a(e){return 401===e.status?(t.set("rh_autherror",{why:"not_authenticated",from:n.path()}),r.onUnauthenticated(),!0):void 0}e.setFullResponse(!0);var i=r.logicBaseUrl;if(angular.isDefined(i)&&null!==i)e.setBaseUrl(i);else{var o;o="http://"+n.host()+":8080/_logic",e.setBaseUrl(o)}e.setErrorInterceptor(function(e,t,n){var r=a(e);return r})})}angular.module("restheart").factory("RhLogic",e),e.$inject=["Restangular","localStorageService","$location","restheart"]}();